<!DOCTYPE html>
<html>
<head>
  <title>Next Pay Period Booking Links</title>
  <style>
    .week-container {
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .week-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .date-line {
      margin: 4px 0;
    }
    .holiday {
      font-weight: bold;
      color: red;
      margin-left: 6px;
    }
  </style>
</head>
<body>

  <h3>
    <a href="https://ds4114.github.io/agil/index.html" target="_blank">
      Login first
    </a>
  </h3>

  <h2>Select Dates for NEXT Pay Period </h2>

  <div id="week1" class="week-container">
    <div class="week-title">Week 1</div>
  </div>

  <div id="week2" class="week-container">
    <div class="week-title">Week 2</div>
  </div>

  <button id="openButton">Submit</button>

  <script>
    const startHour = 9;
    const endHour = 17;
    const baseURL = "https://login.agilquest.com/availsearch/list/byassets";
    const WEEKDAYS_PER_WEEK = 5;

    // Federal holidays 2025â€“2027 (MM-DD-YYYY format)
    const federalHolidays = {
      // 2025
      "01-01-2025": "New Year's Day",
      "01-20-2025": "Martin Luther King Jr. Day",
      "02-17-2025": "Presidents' Day",
      "05-26-2025": "Memorial Day",
      "06-19-2025": "Juneteenth",
      "07-04-2025": "Independence Day",
      "09-01-2025": "Labor Day",
      "10-13-2025": "Columbus Day",
      "11-11-2025": "Veterans Day",
      "11-27-2025": "Thanksgiving Day",
      "12-25-2025": "Christmas Day",
      
      // 2026
      "01-01-2026": "New Year's Day",
      "01-19-2026": "Martin Luther King Jr. Day",
      "02-16-2026": "Presidents' Day",
      "05-25-2026": "Memorial Day",
      "06-19-2026": "Juneteenth",
      "07-03-2026": "Independence Day (Observed)",
      "09-07-2026": "Labor Day",
      "10-12-2026": "Columbus Day",
      "11-11-2026": "Veterans Day",
      "11-26-2026": "Thanksgiving Day",
      "12-25-2026": "Christmas Day",
      
      // 2027
      "01-01-2027": "New Year's Day",
      "01-18-2027": "Martin Luther King Jr. Day",
      "02-15-2027": "Presidents' Day",
      "05-31-2027": "Memorial Day",
      "06-18-2027": "Juneteenth (Observed)",
      "07-05-2027": "Independence Day (Observed)",
      "09-06-2027": "Labor Day",
      "10-11-2027": "Columbus Day",
      "11-11-2027": "Veterans Day",
      "11-25-2027": "Thanksgiving Day",
      "12-24-2027": "Christmas Day (Observed)"
    };

    function buildLink(dateObj) {
      const year = dateObj.getFullYear();
      const month = dateObj.getMonth() + 1;
      const day = dateObj.getDate();

      const params = new URLSearchParams({
        attrs: JSON.stringify({ bools: [], strings: [], numberRels: {}, dept: null }),
        category: 2,
        cty: "null",
        end: JSON.stringify({
          year: year,
          month: month,
          dayOfMonth: day,
          hour: endHour,
          minute: 0,
          tzIdValue: "America/New_York",
          discriminator: "AqDate"
        }),
        fl: 6,
        fls: "[]",
        loc: JSON.stringify({
          sysidVenue: 1,
          sysidVenues: [],
          tzIdValue: "America/New_York"
        }),
        rType: 1,
        rule: JSON.stringify({ flags: { isPattern: false } }),
        start: JSON.stringify({
          discriminator: "AqDate",
          dayOfMonth: day,
          month: month,
          year: year,
          hour: startHour,
          minute: 0,
          tzIdValue: "America/New_York"
        }),
        ts: Date.now(),
        types: "[74,13]"
      });

      return baseURL + "?" + params.toString();
    }

    function getHolidayName(dateObj) {
      const year = dateObj.getFullYear();
      const mm = String(dateObj.getMonth() + 1).padStart(2, "0");
      const dd = String(dateObj.getDate()).padStart(2, "0");
      const key = `${mm}-${dd}-${year}`;
      return federalHolidays[key] || null;
    }

    // --- Calculate first Monday of next pay period ---
    const today = new Date();
    let firstMondayNextPeriod = new Date(today);
    firstMondayNextPeriod.setDate(today.getDate() + 14); // start of next pay period

    // Move to Monday
    const dow = firstMondayNextPeriod.getDay();
    const daysUntilMonday = (1 + 7 - dow) % 7;
    firstMondayNextPeriod.setDate(firstMondayNextPeriod.getDate() + daysUntilMonday);

    // Week 2 starts 1 week later
    let secondMondayNextPeriod = new Date(firstMondayNextPeriod);
    secondMondayNextPeriod.setDate(firstMondayNextPeriod.getDate() + 7);

    const week1Container = document.getElementById("week1");
    const week2Container = document.getElementById("week2");

    function addWeek(container, startDate) {
      let addedDays = 0;
      let i = 0;
      while (addedDays < WEEKDAYS_PER_WEEK) {
        const dateObj = new Date(startDate);
        dateObj.setDate(startDate.getDate() + i);

        const dayOfWeek = dateObj.getDay();
        if (dayOfWeek !== 0 && dayOfWeek !== 6) { // skip weekends
          const url = buildLink(dateObj);
          const dateString = dateObj.toLocaleDateString("en-US", {
            weekday: "short",
            month: "long",
            day: "numeric",
            year: "numeric"
          });

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = "day" + container.id + addedDays;
          checkbox.dataset.url = url;

          const label = document.createElement("a");
          label.href = url;
          label.target = "_blank";
          label.innerText = " " + dateString;
          label.style.marginLeft = "6px";

          const line = document.createElement("div");
          line.className = "date-line";
          line.appendChild(checkbox);
          line.appendChild(label);

          const holidayName = getHolidayName(dateObj);
          if (holidayName) {
            const holidayLabel = document.createElement("span");
            holidayLabel.className = "holiday";
            holidayLabel.innerText = " (" + holidayName + ")";
            line.appendChild(holidayLabel);
          }

          container.appendChild(line);
          addedDays++;
        }
        i++;
      }
    }

    addWeek(week1Container, firstMondayNextPeriod);
    addWeek(week2Container, secondMondayNextPeriod);

    document.getElementById("openButton").addEventListener("click", () => {
      const checkboxes = document.querySelectorAll("input[type='checkbox']");
      checkboxes.forEach(cb => {
        if (cb.checked) {
          window.open(cb.dataset.url, "_blank");
        }
      });
    });

  </script>

</body>
</html>
